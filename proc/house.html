<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="CONMAX -- General nonlinearly constrained function minimization">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>house &ndash; conmax</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">conmax </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../sourcefile/conmax.f90.html">Source File</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>house
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 5.0% of total for procedures.">172 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/conmax.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/conmax.f90.html'>conmax.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/conmax_module.html'>conmax_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">house</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/house.html#src">house</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine house(n, Ncor, Picor, r, Kpivot, Nparm, Aa, Beta, d, Save, b, Vec, Ihouse)  
</h2>
    

    <p>Given ncor n dimensional vectors as columns of the n by ncor
matrix picor and an n dimensional vector r, this subroutine uses
householder transformations to find the best least squares solution
vec to the linear system of equations picor*vec = r, where vec
is an ncor dimensional vector.  if the rank of picor is
(computationally) 0, the subroutine will return with the failure
warning ihouse=1, otherwise it will return with ihouse=0.  if the
rank is &gt; 0 but &lt; ncor, then (ncor - rank) of the components
of vec will be set to 0.0.  the arays picor and r will not be
changed by this subroutine.  the subroutine will attempt up to
numref iterative refinements of the solution, where the user can
set numref as any nonnegative integer, but to get the most out of
the iterative refinement process, the computation of the residual
summ near the end of this subroutine should be done in higher
precision than the other computations in the subroutine.</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-n~4"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>n</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ncor~4"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ncor</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-picor~2"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Picor</strong>(Nparm+1,Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-r~3"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>r</strong>(Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kpivot"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Kpivot</strong>(Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nparm~19"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Nparm</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aa"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Aa</strong>(Nparm+1,Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-beta"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Beta</strong>(Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-d"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>d</strong>(Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-save"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Save</strong>(Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>b</strong>(Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-vec~2"></span>
              real(kind=wp)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Vec</strong>(Nparm+1)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ihouse"></span>
              integer,
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ihouse</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Called by</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~house~~CalledByGraph Pages: 1 -->
<svg id="prochouseCalledByGraph" width="641pt" height="105pt"
 viewBox="0.00 0.00 641.00 104.89" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~house~~CalledByGraph" class="graph" transform="scale(0.69 0.69) rotate(0) translate(4 149)">
<title>proc~~house~~CalledByGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-149 931,-149 931,4 -4,4"/>
<!-- proc~house -->
<g id="proc~~house~~CalledByGraph_node1" class="node">
<title>proc~house</title>
<polygon fill="none" stroke="black" points="927,-64.97 873,-64.97 873,-40.97 927,-40.97 927,-64.97"/>
<text text-anchor="middle" x="900" y="-50.57" font-family="Helvetica,sans-Serif" font-size="10.50">house</text>
</g>
<!-- proc~conenr -->
<g id="proc~~house~~CalledByGraph_node2" class="node">
<title>proc~conenr</title>
<g id="a_proc~~house~~CalledByGraph_node2"><a xlink:href="../proc/conenr.html" xlink:title="conenr">
<polygon fill="#d9534f" stroke="#d9534f" points="837,-64.97 783,-64.97 783,-40.97 837,-40.97 837,-64.97"/>
<text text-anchor="middle" x="810" y="-50.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">conenr</text>
</a>
</g>
</g>
<!-- proc~conenr&#45;&gt;proc~house -->
<g id="proc~~house~~CalledByGraph_edge1" class="edge">
<title>proc~conenr&#45;&gt;proc~house</title>
<path fill="none" stroke="#000000" d="M837.4,-52.97C845.39,-52.97 854.31,-52.97 862.82,-52.97"/>
<polygon fill="#000000" stroke="#000000" points="862.92,-56.47 872.92,-52.97 862.92,-49.47 862.92,-56.47"/>
</g>
<!-- proc~wolfe -->
<g id="proc~~house~~CalledByGraph_node3" class="node">
<title>proc~wolfe</title>
<g id="a_proc~~house~~CalledByGraph_node3"><a xlink:href="../proc/wolfe.html" xlink:title="wolfe">
<polygon fill="#d9534f" stroke="#d9534f" points="747,-64.97 693,-64.97 693,-40.97 747,-40.97 747,-64.97"/>
<text text-anchor="middle" x="720" y="-50.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">wolfe</text>
</a>
</g>
</g>
<!-- proc~wolfe&#45;&gt;proc~conenr -->
<g id="proc~~house~~CalledByGraph_edge2" class="edge">
<title>proc~wolfe&#45;&gt;proc~conenr</title>
<path fill="none" stroke="#000000" d="M747.4,-52.97C755.39,-52.97 764.31,-52.97 772.82,-52.97"/>
<polygon fill="#000000" stroke="#000000" points="772.92,-56.47 782.92,-52.97 772.92,-49.47 772.92,-56.47"/>
</g>
<!-- proc~conmax -->
<g id="proc~~house~~CalledByGraph_node4" class="node">
<title>proc~conmax</title>
<g id="a_proc~~house~~CalledByGraph_node4"><a xlink:href="../proc/conmax.html" xlink:title="conmax_solver%conmax">
<polygon fill="#d9534f" stroke="#d9534f" points="145,-124.97 0,-124.97 0,-100.97 145,-100.97 145,-124.97"/>
<text text-anchor="middle" x="72.5" y="-110.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">conmax_solver%conmax</text>
</a>
</g>
</g>
<!-- proc~conmax&#45;&gt;proc~wolfe -->
<g id="proc~~house~~CalledByGraph_edge3" class="edge">
<title>proc~conmax&#45;&gt;proc~wolfe</title>
<path fill="none" stroke="#000000" d="M124.33,-124.99C142.14,-128.64 162.36,-132.17 181,-133.97 316.81,-147.11 352.48,-149.79 488,-133.97 564.67,-125.02 586.16,-124.62 657,-93.97 670.64,-88.07 684.56,-79.18 695.75,-71.18"/>
<polygon fill="#000000" stroke="#000000" points="698.11,-73.79 704.07,-65.03 693.95,-68.16 698.11,-73.79"/>
</g>
<!-- proc~rkcon -->
<g id="proc~~house~~CalledByGraph_node6" class="node">
<title>proc~rkcon</title>
<g id="a_proc~~house~~CalledByGraph_node6"><a xlink:href="../proc/rkcon.html" xlink:title="conmax_solver%rkcon">
<polygon fill="#d9534f" stroke="#d9534f" points="316,-82.97 183,-82.97 183,-58.97 316,-58.97 316,-82.97"/>
<text text-anchor="middle" x="249.5" y="-68.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">conmax_solver%rkcon</text>
</a>
</g>
</g>
<!-- proc~conmax&#45;&gt;proc~rkcon -->
<g id="proc~~house~~CalledByGraph_edge10" class="edge">
<title>proc~conmax&#45;&gt;proc~rkcon</title>
<path fill="none" stroke="#000000" d="M123.65,-100.94C143.88,-96.08 167.38,-90.44 188.51,-85.37"/>
<polygon fill="#000000" stroke="#000000" points="189.44,-88.75 198.34,-83.01 187.8,-81.94 189.44,-88.75"/>
</g>
<!-- proc~slpcon -->
<g id="proc~~house~~CalledByGraph_node9" class="node">
<title>proc~slpcon</title>
<g id="a_proc~~house~~CalledByGraph_node9"><a xlink:href="../proc/slpcon.html" xlink:title="conmax_solver%slpcon">
<polygon fill="#d9534f" stroke="#d9534f" points="318,-124.97 181,-124.97 181,-100.97 318,-100.97 318,-124.97"/>
<text text-anchor="middle" x="249.5" y="-110.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">conmax_solver%slpcon</text>
</a>
</g>
</g>
<!-- proc~conmax&#45;&gt;proc~slpcon -->
<g id="proc~~house~~CalledByGraph_edge14" class="edge">
<title>proc~conmax&#45;&gt;proc~slpcon</title>
<path fill="none" stroke="#000000" d="M145.18,-112.97C153.57,-112.97 162.16,-112.97 170.63,-112.97"/>
<polygon fill="#000000" stroke="#000000" points="170.87,-116.47 180.87,-112.97 170.87,-109.47 170.87,-116.47"/>
</g>
<!-- proc~corrct -->
<g id="proc~~house~~CalledByGraph_node5" class="node">
<title>proc~corrct</title>
<g id="a_proc~~house~~CalledByGraph_node5"><a xlink:href="../proc/corrct.html" xlink:title="conmax_solver%corrct">
<polygon fill="#d9534f" stroke="#d9534f" points="657,-84.97 524,-84.97 524,-60.97 657,-60.97 657,-84.97"/>
<text text-anchor="middle" x="590.5" y="-70.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">conmax_solver%corrct</text>
</a>
</g>
</g>
<!-- proc~corrct&#45;&gt;proc~wolfe -->
<g id="proc~~house~~CalledByGraph_edge4" class="edge">
<title>proc~corrct&#45;&gt;proc~wolfe</title>
<path fill="none" stroke="#000000" d="M657.12,-62.68C665.94,-61.3 674.72,-59.92 682.77,-58.66"/>
<polygon fill="#000000" stroke="#000000" points="683.54,-62.08 692.88,-57.07 682.46,-55.16 683.54,-62.08"/>
</g>
<!-- proc~rkcon&#45;&gt;proc~wolfe -->
<g id="proc~~house~~CalledByGraph_edge5" class="edge">
<title>proc~rkcon&#45;&gt;proc~wolfe</title>
<path fill="none" stroke="#000000" d="M265.85,-58.78C285.12,-44.31 319.81,-21.03 354,-11.97 471.84,19.26 617.25,-19.03 683.32,-40.41"/>
<polygon fill="#000000" stroke="#000000" points="682.26,-43.75 692.85,-43.56 684.45,-37.1 682.26,-43.75"/>
</g>
<!-- proc~rkcon&#45;&gt;proc~corrct -->
<g id="proc~~house~~CalledByGraph_edge7" class="edge">
<title>proc~rkcon&#45;&gt;proc~corrct</title>
<path fill="none" stroke="#000000" d="M316.26,-71.36C372.87,-71.69 454.56,-72.18 513.86,-72.53"/>
<polygon fill="#000000" stroke="#000000" points="513.9,-76.03 523.92,-72.59 513.94,-69.03 513.9,-76.03"/>
</g>
<!-- proc~rkpar -->
<g id="proc~~house~~CalledByGraph_node7" class="node">
<title>proc~rkpar</title>
<g id="a_proc~~house~~CalledByGraph_node7"><a xlink:href="../proc/rkpar.html" xlink:title="conmax_solver%rkpar">
<polygon fill="#d9534f" stroke="#d9534f" points="486.5,-44.97 355.5,-44.97 355.5,-20.97 486.5,-20.97 486.5,-44.97"/>
<text text-anchor="middle" x="421" y="-30.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">conmax_solver%rkpar</text>
</a>
</g>
</g>
<!-- proc~rkcon&#45;&gt;proc~rkpar -->
<g id="proc~~house~~CalledByGraph_edge11" class="edge">
<title>proc~rkcon&#45;&gt;proc~rkpar</title>
<path fill="none" stroke="#000000" d="M304.13,-58.95C320.75,-55.22 339.23,-51.08 356.45,-47.22"/>
<polygon fill="#000000" stroke="#000000" points="357.44,-50.59 366.43,-44.98 355.9,-43.76 357.44,-50.59"/>
</g>
<!-- proc~searsl -->
<g id="proc~~house~~CalledByGraph_node8" class="node">
<title>proc~searsl</title>
<g id="a_proc~~house~~CalledByGraph_node8"><a xlink:href="../proc/searsl.html" xlink:title="conmax_solver%searsl">
<polygon fill="#d9534f" stroke="#d9534f" points="488,-124.97 354,-124.97 354,-100.97 488,-100.97 488,-124.97"/>
<text text-anchor="middle" x="421" y="-110.57" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">conmax_solver%searsl</text>
</a>
</g>
</g>
<!-- proc~rkcon&#45;&gt;proc~searsl -->
<g id="proc~~house~~CalledByGraph_edge12" class="edge">
<title>proc~rkcon&#45;&gt;proc~searsl</title>
<path fill="none" stroke="#000000" d="M299.07,-83.01C318.58,-87.84 341.23,-93.45 361.62,-98.51"/>
<polygon fill="#000000" stroke="#000000" points="360.87,-101.93 371.42,-100.94 362.56,-95.13 360.87,-101.93"/>
</g>
<!-- proc~rkpar&#45;&gt;proc~wolfe -->
<g id="proc~~house~~CalledByGraph_edge6" class="edge">
<title>proc~rkpar&#45;&gt;proc~wolfe</title>
<path fill="none" stroke="#000000" d="M486.81,-37.34C546.92,-41.38 634.19,-47.26 682.82,-50.54"/>
<polygon fill="#000000" stroke="#000000" points="682.66,-54.03 692.87,-51.21 683.13,-47.05 682.66,-54.03"/>
</g>
<!-- proc~rkpar&#45;&gt;proc~corrct -->
<g id="proc~~house~~CalledByGraph_edge8" class="edge">
<title>proc~rkpar&#45;&gt;proc~corrct</title>
<path fill="none" stroke="#000000" d="M472.26,-44.97C490.14,-49.25 510.47,-54.1 529.12,-58.55"/>
<polygon fill="#000000" stroke="#000000" points="528.45,-61.99 538.99,-60.91 530.08,-55.18 528.45,-61.99"/>
</g>
<!-- proc~searsl&#45;&gt;proc~corrct -->
<g id="proc~~house~~CalledByGraph_edge9" class="edge">
<title>proc~searsl&#45;&gt;proc~corrct</title>
<path fill="none" stroke="#000000" d="M472.26,-100.97C490.14,-96.7 510.47,-91.84 529.12,-87.39"/>
<polygon fill="#000000" stroke="#000000" points="530.08,-90.76 538.99,-85.03 528.45,-83.95 530.08,-90.76"/>
</g>
<!-- proc~slpcon&#45;&gt;proc~searsl -->
<g id="proc~~house~~CalledByGraph_edge13" class="edge">
<title>proc~slpcon&#45;&gt;proc~searsl</title>
<path fill="none" stroke="#000000" d="M318.47,-112.97C326.78,-112.97 335.32,-112.97 343.75,-112.97"/>
<polygon fill="#000000" stroke="#000000" points="343.95,-116.47 353.95,-112.97 343.95,-109.47 343.95,-116.47"/>
</g>
</g>
</svg>
</div>                <script>
                  var panprochouseCalledByGraph = svgPanZoom('#prochouseCalledByGraph',
                    {zoomEnabled: true, controlIconsEnabled: true, fit: true, center: true,}
                  );
                </script>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CalledByGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CalledByGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">    </span><span class="k">subroutine </span><span class="n">house</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span><span class="p">,</span><span class="w"> </span><span class="n">Picor</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">Kpivot</span><span class="p">,</span><span class="w"> </span><span class="n">Nparm</span><span class="p">,</span><span class="w"> </span><span class="n">Aa</span><span class="p">,</span><span class="w"> </span><span class="n">Beta</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="k">Save</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">Vec</span><span class="p">,</span><span class="w"> </span><span class="n">Ihouse</span><span class="p">)</span>

<span class="w">        </span><span class="k">implicit none</span>

<span class="k">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">Nparm</span>
<span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Ihouse</span>
<span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span>
<span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">        </span><span class="kt">integer</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">Kpivot</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Beta</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Picor</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="k">Save</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Vec</span><span class="p">(</span><span class="n">Nparm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">aakk</span><span class="p">,</span><span class="w"> </span><span class="nb">amax</span><span class="p">,</span><span class="w"> </span><span class="n">sqdk</span><span class="p">,</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="nb">sum</span><span class="p">,</span><span class="w"> </span><span class="n">summ</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">testt</span>
<span class="w">        </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ia</span><span class="p">,</span><span class="w"> </span><span class="n">icount</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">kchnge</span><span class="p">,</span><span class="w"> </span><span class="n">kk</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                   </span><span class="n">kp</span><span class="p">,</span><span class="w"> </span><span class="n">krank</span><span class="p">,</span><span class="w"> </span><span class="n">kt</span>

<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tolsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ten</span><span class="o">*</span><span class="n">ten</span><span class="o">*</span><span class="n">spcmn</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">numref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c">!! Set numref = the limit on the number of iterative refinement steps.</span>
<span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nmref1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numref</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nmref2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numref</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>

<span class="w">        </span><span class="c">! COMPUTE MACHINE AND PRECISION DEPENDENT CONSTANTS.</span>
<span class="w">        </span><span class="n">Ihouse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">        </span><span class="c">! SET KRANK = MIN(N,NCOR).  THIS MAY BE REDUCED LATER.</span>
<span class="w">        </span><span class="n">krank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Ncor</span><span class="p">)</span><span class="w"> </span><span class="n">krank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span>
<span class="w">        </span><span class="c">! INITIALLY SET KPIVOT.  AFTER ALL COLUMN INTERCHANGES ARE DONE</span>
<span class="w">        </span><span class="c">! KPIVOT(J) WILL BE THE ORIGINAL POSITION OF THE COLUMN WHERE THE</span>
<span class="w">        </span><span class="c">! JTH PIVOT WAS DONE.  THIS COLUMN WILL BE MOVED TO COLUMN J.</span>
<span class="w">        </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">            </span><span class="n">Kpivot</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span>
<span class="w">        </span><span class="k">end do</span>
<span class="w">        </span><span class="c">! COPY R INTO B AND PICOR INTO AA, BUT IN THE PROCESS REPLACE ANY NUMBERS</span>
<span class="w">        </span><span class="c">! WITH ABSOLUTE VALUE LESS THAN SPCMN BY ZERO TO AVOID UNDERFLOWS.</span>
<span class="w">        </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">spcmn</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">else</span>
<span class="k">                </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">        end do</span>
<span class="k">        do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Picor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">spcmn</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                    </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Picor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">            end do</span>
<span class="k">        end do</span>
<span class="k">        do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">            </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="n">kchnge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span>
<span class="w">            </span><span class="k">do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">ia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Aa</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">spcmn</span><span class="p">)</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="p">)</span><span class="o">*</span><span class="n">Aa</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">sum</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">kchnge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jj</span>
<span class="w">                    </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">                </span><span class="k">end if</span>
<span class="k">            end do</span>

<span class="w">            </span><span class="c">!  KCHNGE CONTAINS THE INDEX OF THE COLUMN OF GREATEST</span>
<span class="w">            </span><span class="c">!  LENGTH BETWEEN K AND NCOR (FROM POSITION K TO THE BOTTOM).</span>
<span class="w">            </span><span class="c">! IF K=1 AND D(K) &lt; TOLSQ WE RETURN WITH THE FAILURE WARNING</span>
<span class="w">            </span><span class="c">! IHOUSE=1.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tolsq</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">Ihouse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="k">return</span>
<span class="k">                end if</span>
<span class="k">            end if</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">kchnge</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="c">!  START COLUMN INTERCHANGE.</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">kchnge</span><span class="p">)</span>
<span class="w">                    </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">kchnge</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">                    </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                </span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kpivot</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">                </span><span class="n">Kpivot</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kpivot</span><span class="p">(</span><span class="n">kchnge</span><span class="p">)</span>
<span class="w">                </span><span class="n">Kpivot</span><span class="p">(</span><span class="n">kchnge</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kk</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="nb">amax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">wp</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ten</span><span class="o">*</span><span class="n">ten</span><span class="o">*</span><span class="n">spcmn</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">amax</span><span class="o">*</span><span class="nb">amax</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! HERE THE LENGTH OF THE BEST OF COLUMNS K THROUGH NCOR (FROM K DOWN)</span>
<span class="w">                    </span><span class="c">! WAS TOO SMALL, AND WE REDUCE KRANK TO K-1 AND LEAVE THIS LOOP.</span>
<span class="w">                    </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<span class="w">                    </span><span class="n">krank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="k">exit</span>
<span class="k">                end if</span>
<span class="k">            end if</span>

<span class="w">            </span><span class="c">! NOW COMPUTE THE SCALAR BETA(K) AND THE N-K+1 DIMENSIONAL VECTOR</span>
<span class="w">            </span><span class="c">! GNU(K) (TO BE PLACED IN AA(K,K),...,AA(N,K)) FOR I(K) - BETA(K)*</span>
<span class="w">            </span><span class="c">! GNU(K)*(GNU(K) TRANSPOSE), WHICH IS THE ACTIVE PART OF THE</span>
<span class="w">            </span><span class="c">! HOUSEHOLDER TRANSFORMATION PH(K) = DIAG(I(K-1), ACTIVE PART).  THIS</span>
<span class="w">            </span><span class="c">! IS A SYMMETRIC ORTHOGONAL MATRIX WHICH WHEN MULTIPLIED TIMES AA WILL</span>
<span class="w">            </span><span class="c">! ZERO OUT AA(K+1,K),...,AA(N,K) AND CHANGE AA(K,K) TO -SGN(OLD</span>
<span class="w">            </span><span class="c">! AA(K,K))*SQDK, WHERE SQDK = LENGTH OF OLD (AA(K,K),...,AA(N,K)) AND</span>
<span class="w">            </span><span class="c">! WE REDEFINE THE SGN FUNCTION TO HAVE VALUE 1.0 IF ITS ARGUMENT IS</span>
<span class="w">            </span><span class="c">! 0.0.  WE WILL HAVE BETA(K) = 1.0/(SQDK**2 + ABS(OLD AA(K,K))*SQDK)</span>
<span class="w">            </span><span class="c">! AND GNU(K) = (OLD AA(K,K) + SGN(OLD AA(K,K))*SQDK, OLD AA(K+1,K),...,</span>
<span class="w">            </span><span class="c">! OLD AA(N,K)).  WE WILL ALSO REPLACE D(K) BY THE NEW AA(K,K) (WHICH</span>
<span class="w">            </span><span class="c">! WILL NOT ACTUALLY BE WRITTEN INTO AA) FOR LATER USE.</span>
<span class="w">            </span><span class="n">aakk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">            </span><span class="n">sqdk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">aakk</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">Beta</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">aakk</span><span class="o">*</span><span class="n">sqdk</span><span class="p">)</span>
<span class="w">                </span><span class="n">Aa</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sqdk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">aakk</span>
<span class="w">                </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqdk</span>
<span class="w">            </span><span class="k">else</span>
<span class="k">                </span><span class="n">Beta</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">aakk</span><span class="o">*</span><span class="n">sqdk</span><span class="p">)</span>
<span class="w">                </span><span class="n">Aa</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqdk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">aakk</span>
<span class="w">                </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sqdk</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            </span><span class="n">kt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">Ncor</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="c">! HERE K &lt; NCOR AND WE MULTIPLY COLUMNS K+1,...,NCOR OF AA BY THE</span>
<span class="w">                </span><span class="c">! HOUSEHOLDER TRANSFORMATION PH(K), WHICH WILL CHANGE ONLY POSITIONS</span>
<span class="w">                </span><span class="c">! K THROUGH THE BOTTOM OF THESE COLUMNS.  THIS IS DONE BY, FOR J =</span>
<span class="w">                </span><span class="c">! K+1,...,NCOR, REPLACING COLUMN J (FROM K DOWN) BY COLUMN J (FROM K DOWN)</span>
<span class="w">                </span><span class="c">! - GNU(K)*(GNU(K).COLUMN J (FROM K DOWN))*BETA(K).</span>
<span class="w">                </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kt</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">                    </span><span class="k">Save</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                    </span><span class="k">do </span><span class="n">ia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                        </span><span class="k">Save</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Save</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Aa</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                        </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="k">Save</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Beta</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end do</span>
<span class="k">            end if</span>
<span class="k">        end do</span>

<span class="k">        do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">krank</span>
<span class="w">            </span><span class="c">! IF I &lt;= MIN(KRANK,NCOR-1), DIVIDE ROW I OF AA FROM COLUMN I+1</span>
<span class="w">            </span><span class="c">! THROUGH COLUMN NCOR BY THE NEW AA(I,I) (WHICH IS NOT ACTUALLY</span>
<span class="w">            </span><span class="c">! WRITTEN INTO AA(I,I), BUT IS STORED IN D(I)).</span>
<span class="w">            </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Ncor</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">            do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">                </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">d</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">        end do</span>

<span class="w">        </span><span class="c">! NOW ALL THE DIAGONAL ELEMENTS OF AA (ALTHOUGH NOT WRITTEN IN)</span>
<span class="w">        </span><span class="c">! ARE 1.0 AND ALL OFF DIAGONAL ELEMENTS OF AA ARE LESS THAN OR</span>
<span class="w">        </span><span class="c">! EQUAL TO 1.0.</span>

<span class="w">        </span><span class="c">! INITIALIZE THE ITERATIVE REFINEMENT COUNTER ICOUNT AND ZERO OUT VEC</span>
<span class="w">        </span><span class="c">! INITIALLY.  THE VEC VALUES NOT CORRESPONDING TO THE FIRST KRANK</span>
<span class="w">        </span><span class="c">! COLUMNS (MODULO EARLIER COLUMN INTERCHANGES) WILL REMAIN AT 0.0.</span>
<span class="w">        </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">            </span><span class="n">Vec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">        </span><span class="k">end do</span>

<span class="k">        </span><span class="n">iteration</span><span class="p">:</span><span class="w"> </span><span class="k">do</span>

<span class="w">            </span><span class="c">! PREMULTIPLY B BY THE HOUSEHOLDER TRANSFORMATIONS PH(1),...,</span>
<span class="w">            </span><span class="c">! PH(KRANK).  RECALL THAT GNU(I) IS STILL IN AA(I,I),...,AA(N,I)</span>
<span class="w">            </span><span class="c">! FOR I=1,...,KRANK.</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">krank</span>
<span class="w">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">ia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="o">*</span><span class="n">Beta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">b</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="nb">sum</span>
<span class="nb">                </span><span class="k">end do</span>
<span class="k">            end do</span>

<span class="w">            </span><span class="c">! NOW ONLY USE THE FIRST KRANK TERMS OF B, AS WE CANT DO ANYTHING ABOUT</span>
<span class="w">            </span><span class="c">! THE OTHERS, WHOSE SQUARE ROOT OF SUM OF SQUARES WILL GIVE THE LEAST</span>
<span class="w">            </span><span class="c">! SQUARES DISTANCE.</span>
<span class="w">            </span><span class="c">! DIVIDE B(I) BY D(I) FOR I=1,...,KRANK AS WE DID THIS TO ROW I OF AA.</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">krank</span>
<span class="w">                </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">d</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>

<span class="w">            </span><span class="c">! THE PROBLEM HAS NOW BEEN REDUCED TO SOLVING (UPPER LEFT KRANK BY</span>
<span class="w">            </span><span class="c">! KRANK PART OF AA)*(FIRST KRANK TERMS OF VEC, MODULO COLUMN</span>
<span class="w">            </span><span class="c">! INTERCHANGE UNSCRAMBLING) = (FIRST KRANK TERMS OF B).  ALTHOUGH THE</span>
<span class="w">            </span><span class="c">! DIAGONAL AND BELOW DIAGONAL TERMS OF THE COEFFICIENT MATRIX HAVE NOT</span>
<span class="w">            </span><span class="c">! BEEN WRITTEN IN, THE SYSTEM IS UPPER TRIANGULAR WITH DIAGONAL ELEMENTS</span>
<span class="w">            </span><span class="c">! ALL EQUAL TO 1.0, SO WE SOLVE BY BACK SUBSTITUTION.  WE FIRST PUT</span>
<span class="w">            </span><span class="c">! THE SOLUTION TO THIS SYSTEM IN B(1),...,B(KRANK) AND SORT IT OUT</span>
<span class="w">            </span><span class="c">! LATER.  IF ICOUNT &gt; 1 THE SOLUTION IS AN ITERATIVE CORRECTION TO</span>
<span class="w">            </span><span class="c">! VEC RATHER THAN VEC ITSELF.</span>
<span class="w">            </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">krank</span>
<span class="w">                </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krank</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ii</span>
<span class="w">                </span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! HERE WE ALREADY HAVE B(I) (WHERE I  &gt; 1) AND WE SUBTRACT AA(J,I)*</span>
<span class="w">                    </span><span class="c">! B(I) FROM B(J) FOR J = 1,...,I-1.</span>
<span class="w">                    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">kk</span>
<span class="w">                        </span><span class="n">b</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Aa</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end if</span>
<span class="k">            end do</span>

<span class="w">            </span><span class="c">!  TEST FOR CONVERGENCE.</span>
<span class="w">            </span><span class="c">!  FIRST TEST, TOO MANY ITERATIONS.</span>
<span class="w">            </span><span class="c">!  SECOND TEST, SEE IF VEC IS DECREASING.</span>

<span class="w">            </span><span class="c">! COMPUTE THE LENGTH SQUARED OF THE FIRST TOP 1 THROUGH KRANK PART OF</span>
<span class="w">            </span><span class="c">! B, WHICH WILL BE THE RESIDUAL VECTOR IF ICOUNT &gt; 1.</span>
<span class="w">            </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">krank</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">spcmn</span><span class="p">)</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">icount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">testt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">            </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="nb">sum</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">test</span><span class="o">/</span><span class="n">two</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nmref2</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span>

<span class="w">            </span><span class="c">! COMPUTE THE VEC VALUES, WHICH WILL BE ACTUAL VEC VALUES IF ICOUNT=1</span>
<span class="w">            </span><span class="c">! AND CORRECTIONS TO VEC VALUES IF ICOUNT &gt; 1.  WE GET THESE BY</span>
<span class="w">            </span><span class="c">! UNSCRAMBLING THE B VALUES AND ADDING THEM TO THE APPROPRIATE OLD VEC</span>
<span class="w">            </span><span class="c">! VALUES (WHICH WILL BE 0.0 IF ICOUNT=1).</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">krank</span>
<span class="w">                </span><span class="n">kp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kpivot</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="n">Vec</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vec</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>

<span class="w">            </span><span class="c">! CALCULATE THE RESIDUAL R - ACOEF*VEC.  RECALL THAT ACOEF AND R</span>
<span class="w">            </span><span class="c">! CONTAIN THE ORIGINAL COEFFICIENT AND RIGHT SIDE ARRAYS RESPECTIVELY.</span>
<span class="w">            </span><span class="c">! TO GET THE MOST OUT OF ITERATIVE REFINEMENT THIS COMPUTATION SHOULD</span>
<span class="w">            </span><span class="c">! PROBABLY BE DONE IN HIGHER PRECISION, IN WHICH CASE IT MAY BE</span>
<span class="w">            </span><span class="c">! FRUITFUL TO ALSO SET NUMREF LARGER AT THE BEGINNING OF THIS</span>
<span class="w">            </span><span class="c">! SUBROUTINE.</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">summ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ncor</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Picor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">spcmn</span><span class="p">)</span><span class="w"> </span><span class="n">summ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summ</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Picor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Vec</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">summ</span>
<span class="w">            </span><span class="k">end do</span>

<span class="w">            </span><span class="c">!  THIRD TEST, WAS THE CORRECTION SIGNIFICANT.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">test</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">spcmn</span><span class="o">*</span><span class="n">testt</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">icount</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nmref1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    if</span><span class="w"> </span><span class="p">(</span><span class="n">icount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nmref2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                        </span><span class="k">cycle </span><span class="n">iteration</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                end if</span>
<span class="k">            end if</span>

<span class="k">            exit </span><span class="n">iteration</span><span class="w">  </span><span class="c">! done</span>

<span class="w">        </span><span class="k">end do </span><span class="n">iteration</span>

<span class="w">    </span><span class="k">end subroutine </span><span class="n">house</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              conmax
 was developed by Jacob Williams<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>